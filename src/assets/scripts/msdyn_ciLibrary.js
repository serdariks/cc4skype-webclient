var Microsoft;(function(a){var b;(function(b){var c;(function(b){b.retryCount=3,b.promiseTimeOut=1e4,b.messageCorrelationId="messageCorrelationId",b.messageSuccess="success",b.messageFailure="failure",b.messageConstant="message",b.originURL="originURL",b.message="message",b.rejectWithErrorMessage=function(b){return Promise.reject(JSON.stringify(a.CIFramework.Utility.buildEntity(a.CIFramework.Utility.createErrorMap(b))))}})(c=b.postMessageNamespace||(b.postMessageNamespace={}))})(b=a.CIFramework||(a.CIFramework={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(a){var b;(function(a){var b;(function(b){function c(b,c){return new Map().set(a.Constants.message,b).set(a.Constants.name,c)}function d(a){return a.message!==void 0}function e(a){let b={};for(let c in a)b[c]="object"==typeof a[c]?e(a[c]):a[c];return b}b.createErrorMap=c,b.isError=d,b.buildMap=function(a){if(d(a))return c(a.message);else{let b=new Map;return Object.keys(a).forEach(c=>{b.set(c,a[c])}),b}},b.mapToString=function(a,b=[]){let c="";return a?(a.forEach((a,d)=>{-1==b.indexOf(d)&&(c+=d+" : "+a+", ")}),c):""},b.flatten=e,b.buildEntity=function(a){let b={};return a.forEach((a,c)=>{b[c]=a}),b},b.extractParameter=function(a,b){var c={};if(null!=a&&""!=a){var d=a.substr(1).split("&");d.forEach(a=>{var b=a.split("="),d=decodeURIComponent(b[0]),e=decodeURIComponent(1<b.length?b[1]:"");c[d]=e})}return c.hasOwnProperty(b)?c[b]:""},b.rgb2hex=function(a){var b=a.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return b&&4===b.length?"#"+("0"+parseInt(b[1],10).toString(16)).slice(-2).toUpperCase()+("0"+parseInt(b[2],10).toString(16)).slice(-2).toUpperCase()+("0"+parseInt(b[3],10).toString(16)).slice(-2).toUpperCase():a},b.getElementFromIframe=function(a,b){return a.contentWindow.document.getElementById(b)},b.getElementsByClassName=function(a,b){return a.contentWindow.document.getElementsByClassName(b)}})(b=a.Utility||(a.Utility={}))})(b=a.CIFramework||(a.CIFramework={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(a){var b;(function(a){class b{}b.setClickToAct="setclicktoact",b.getClickToAct="getclicktoact",b.searchAndOpenRecords="searchandopenrecords",b.openForm="openform",b.createRecord="createrecord",b.deleteRecord="deleterecord",b.retrieveRecord="retrieverecord",b.updateRecord="updaterecord",b.search="search",b.setMode="setmode",b.setWidth="setwidth",b.getMode="getmode",b.getEnvironment="getenvironment",b.getWidth="getwidth",b.onClickToAct="onclicktoact",b.onModeChanged="onmodechanged",b.onSizeChanged="onsizechanged",b.onPageNavigate="onpagenavigate",b.onSendKBArticle="onsendkbarticle",b.onSetPresence="onSetPresence",b.onUISessionVisibilityChanged="onUISessionVisibilityChanged",b.onUISessionStarted="onUISessionStarted",b.onUISessionEnded="onUISessionEnded",b.getEntityMetadata="getEntityMetadata",b.notifyEvent="notifyEvent",b.softNotification="softNotification",b.broadCast="broadCast",b.internalCommunication="internalCommunication",b.notification="notification",b.transfer="transfer",b.escalation="escalation",b.renderSearchPage="renderSearchPage",b.startUISession="startUISession",b.switchUISession="switchUISession",b.endUISession="endUISession",b.onMaxUISessionsReached="onMaxUISessionsReached",b.setAgentPresence="setAgentPresence",b.initializeAgentPresenceList="initializeAgentPresenceList",b.insertNotes="insertNotes",b.openKBSearchControl="openkbsearchcontrol",b.onSetPresenceEvent="setPresenceEvent",b.hardNotification="hardNotification",b.removeGenericHandler="removeGenericHandler",b.addGenericHandler="addGenericHandler",a.MessageType=b;class c{}c.customParams="msdyn_customparams",c.customParamsKey="customParams",c.value="value",c.entityName="entityName",c.entityId="entityId",c.queryParameters="queryParameters",c.message="message",c.searchOnly="searchOnly",c.entityFormOptions="entityFormOptions",c.entityFormParameters="entityFormParameters",c.ScriptIdAttributeName="data-cifid",c.ScriptIdAttributeValue="CIFMainLibrary",c.ScriptCRMUrlAttributeName="data-crmurl",c.name="msdyn_name",c.originURL="originURL",c.CIClickToAct="CIClickToAct",c.CISendKBArticle="KMClickToSend",c.SetPresenceEvent="setPresenceEvent",c.widgetIframeId="SidePanelIFrame",c.clickToActAttributeName="msdyn_clicktoact",c.systemUserLogicalName="systemuser",c.appSelectorFieldName="msdyn_appselector",c.sortOrderFieldName="msdyn_sortorder",c.roleSelectorFieldName="msdyn_roleselector",c.providerOdataQuery="?$select=fullname&$expand=msdyn_ciprovider_systemuser_membership($filter=statecode eq 0;$orderby=msdyn_sortorder asc,createdon asc;$top={0})",c.providerNavigationProperty="msdyn_ciprovider_systemuser_membership",c.providerId="msdyn_ciproviderid",c.landingUrl="msdyn_landingurl",c.label="msdyn_label",c.providerLogicalName="msdyn_ciprovider",c.widgetHeight="msdyn_widgetheight",c.widgetWidth="msdyn_widgetwidth",c.SizeChangeHandler="sizeChangeHandler",c.ModeChangeHandler="modeChangedHandler",c.NavigationHandler="NavigationHandler",c.AppName="appName",c.ClientUrl="clientUrl",c.AppUrl="appUrl",c.Theme="themeName",c.OrgLcid="orgLcid",c.OrgUniqueName="orgUniqueName",c.UserId="userId",c.UserLcid="userLcid",c.UserName="username",c.DefaultCountryCode="defaultCountryCode",c.MinimizedHeight=34,c.DefaultFullWidth=100,c.APIVersion="msdyn_ciproviderapiversion",c.SortOrder="msdyn_sortorder",c.crmVersion="crmVersion",c.CIFInitEvent="CIFInitDone",c.Attributes="attributes",c.UciLib="ucilib",c.OrgId="orgId",c.trustedDomain="msdyn_trusteddomain",c.eventType="eventType",c.headerDataCIF="headerDataCIF",c.bodyDataCIF="bodyDataCIF",c.notificationUXObject="notificationUXObject",c.actionDisplayText="actionDisplayText",c.actionReturnValue="actionReturnValue",c.actionsCIF="actions",c.actionName="actionName",c.CIFNotificationIcon="CIFNotificationIcon",c.actionColor="actionColor",c.actionImage="actionImage",c.Timeout="Timeout",c.Accept="Accept",c.Reject="Reject",c.actionType="actionType",c.notificationType="notificationType",c.Timer="Timer",c.NoOfNotifications="NoOfNotifications",c.SMS="sms",c.Chat="chat",c.Call="call",c.Case="case",c.SearchString="searchString",c.context="context",c.initials="initials",c.sessionId="sessionId",c.MaxUISessions=5,c.sessionColors=["#2A757D","#70278B","#FF8C00","#427825","#B4009E","#B4A0FF"],c.sessionPanel="sessionPanel",c.DEFAULT_WIDGET_WIDTH=378,c.DEFAULT_SIDEPANEL_WIDTH=34,c.DEFAULT_SIDEPANEL_WIDTH_WITH_BORDER=36,c.presenceInfo="presenceInfo",c.presenceList="presenceList",c.activityType="activityType",c.sessionDetails="sessionDetails",c.activityId="activityId",c.Id="id",c.notetext="notetext",c.annotation="annotation",c.entitySetName="entitySetName",c.annotationId="annotationid",c.secRemaining="secs remaining",c.Informational="informational",c.Failure="failure",a.Constants=c,a.isNullOrUndefined=function(a){return null==a||"undefined"==typeof a}})(b=a.CIFramework||(a.CIFramework={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(a){var b;(function(b){var c;(function(b){b.postMsgWrapper=class{constructor(a,c,d,e){this.pendingPromises=new Map,this.messageHandlers=new Map,this.responseTargetWindow=null,a&&(a.removeEventListener(b.messageConstant,this.processMessage.bind(this)),a.addEventListener(b.messageConstant,this.processMessage.bind(this))),this.listWhitelistedDomains=c,d&&(this.messageHandlers=d),this.responseTargetWindow=e}addHandler(a,b){this.messageHandlers.has(a)?this.messageHandlers.get(a).add(b):this.messageHandlers.set(a,new Set().add(b))}getHandlers(a){return this.messageHandlers.has(a)?this.messageHandlers.get(a):null}removeHandler(a,b){this.messageHandlers.has(a)&&this.messageHandlers.get(a).delete(b)}getCorrelationId(){return(Math.random()+1).toString(36).substring(7)}createDeferred(c){const d={promise:null,resolve:null,reject:null,timerId:null};let e=new Promise((a,b)=>{d.resolve=a,d.reject=b}),f=[e];if(!c){let c=new Promise((c,e)=>{d.timerId=setTimeout(()=>{e(a.CIFramework.Utility.createErrorMap("Timeout occurred as no response was received from listener window"))},b.promiseTimeOut)});f.push(c)}return d.promise=Promise.race(f).then(a=>(d.timerId&&clearTimeout(d.timerId),this.removePromise(d),a)).catch(a=>{throw d.timerId&&clearTimeout(d.timerId),this.removePromise(d),a}),d}removePromise(a){let b=null;for(let[c,d]of this.pendingPromises)if(d==a){b=c;break}b&&this.pendingPromises.delete(b)}postMsg(a,c,d,e,f){if(a&&"*"!=d){let e=this.createDeferred(f),g=this.getCorrelationId(),h=c;return h[b.messageCorrelationId]=g,this.pendingPromises.set(g,e),this.postMsgInternal(a,h,d,e)}return b.rejectWithErrorMessage("Receiving window or targetOrigin cannot be unspecified")}postMsgInternal(a,c,d,e){for(let f=0;;)try{return a.postMessage(c,d),e?e.promise:void 0}catch(a){if(++f==b.retryCount)return b.rejectWithErrorMessage("Not able to post the request to receiving window after multiple tries.")}}sendResponseMsg(a,b,c){a&&"*"!=c&&a.postMessage(b,c)}processMessage(c){let d,e=this.responseTargetWindow||c.source,f=this.listWhitelistedDomains.find(a=>{var b,d=new URL(c.origin),e=decodeURIComponent(d.hostname),f="";return(null!=a&&(b=new URL(a),f=decodeURIComponent(b.hostname)),""!=f&&f==e)||!!(null!=a&&f.startsWith("*"))&&e.endsWith(f.substr(2))}),g=c.data[b.messageCorrelationId],h=null;if(c.origin&&"*"!==c.origin&&c.source||(h=a.CIFramework.Utility.createErrorMap("Origin/Source of the message cant be null or all")),f||(h=a.CIFramework.Utility.createErrorMap("Sender domain is not a recognised or is invalid and hence the message cant be processed")),!g){if(h)return void console.trace("Ignoring message from unknown event source: "+c.origin);}else if(h)return d={messageOutcome:b.messageFailure,messageData:h,messageCorrelationId:g},this.sendResponseMsg(e,d,c.origin);let i;if(g&&this.pendingPromises&&(i=this.pendingPromises.get(g)),!i){let h=c.data;if("string"!=typeof h.messageData&&h.messageData.set(b.originURL,f),!this.messageHandlers.get(h.messageType))return void(g&&(d={messageOutcome:b.messageSuccess,messageData:a.CIFramework.Utility.createErrorMap("No handlers found to process the request."),messageCorrelationId:g},this.sendResponseMsg(e,d,c.origin)));this.messageHandlers.get(h.messageType).forEach(a=>{a(h.messageData).then(function(a){g&&(d={messageOutcome:b.messageSuccess,messageData:a,messageCorrelationId:g},this.sendResponseMsg(e,d,c.origin))}.bind(this),function(a){g&&(d={messageOutcome:b.messageFailure,messageData:a,messageCorrelationId:g},this.sendResponseMsg(e,d,c.origin))}.bind(this))})}else{let a=c.data;a.messageOutcome===b.messageSuccess?i.resolve(a.messageData):i.reject(a.messageData)}}}})(c=b.postMessageNamespace||(b.postMessageNamespace={}))})(b=a.CIFramework||(a.CIFramework={}))})(Microsoft||(Microsoft={}));var Microsoft;(function(a){var b;(function(b){function c(){Date.now();v=window.top;var c=document.createElement("a"),d=document.referrer,e="";try{var f=document.querySelector("script["+y.ScriptIdAttributeName+"=\""+y.ScriptIdAttributeValue+"\"]"),g=f.getAttribute(y.ScriptCRMUrlAttributeName);g&&(d=g)}catch(a){}try{e=a.CIFramework.Utility.extractParameter(window.location.search,y.UciLib)}catch(a){}if(c.href=d,x.push(c.protocol+"//"+c.hostname),""!=e&&null!=e){let a=document.createElement("a");a.href=e,x.push(a.protocol+"//"+a.hostname)}1<x.length,w=new b.postMessageNamespace.postMsgWrapper(window,x,null,v);var h=new CustomEvent(y.CIFInitEvent,{detail:x});window.setTimeout(function(){window.dispatchEvent(h)},0)}function d(a,c,d,e){Date.now();return new Promise((a,d)=>w.postMsg(v,c,x[x.length-1],!1,e).then(c=>c&&!b.isNullOrUndefined(c.get(y.value))?a(c.get(y.value)):a(null),a=>d(a)))}function e(a){b.isNullOrUndefined(a)&&(a=!1);const c={messageType:b.MessageType.setClickToAct,messageData:new Map().set(y.value,a)};return d(e.name,c,!1)}function f(c,e){if(!(b.isNullOrUndefined(c)||""==c)){const g={messageType:b.MessageType.openForm,messageData:new Map().set(y.entityFormOptions,c).set(y.entityFormParameters,e)};return new Promise((b,c)=>d(f.name,g,!1,!0).then(function(a){return b(JSON.stringify(a))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityFormOptions parameter is blank. Provide a value to the parameter."):void 0}function g(c,e,f){if(!(b.isNullOrUndefined(c)||""==c)&&!(b.isNullOrUndefined(e)||""==e)){const h={messageType:b.MessageType.retrieveRecord,messageData:new Map().set(y.entityName,c).set(y.entityId,e).set(y.queryParameters,f)};return new Promise((b,c)=>d(g.name,h,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(e)||""==e?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):void 0}function h(c,e,f){if(!(b.isNullOrUndefined(c)||""==c)&&!(b.isNullOrUndefined(e)||""==e)&&!b.isNullOrUndefined(f)){const g={messageType:b.MessageType.updateRecord,messageData:new Map().set(y.entityName,c).set(y.entityId,e).set(y.value,a.CIFramework.Utility.buildMap(JSON.parse(f)))};return new Promise((b,c)=>d(h.name,g,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(e)||""==e?b.postMessageNamespace.rejectWithErrorMessage("The EntityId parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(f)?b.postMessageNamespace.rejectWithErrorMessage("The parameter is blank. Provide a value to the parameter to update the record."):void 0}function i(c,e){if(!(b.isNullOrUndefined(c)||""==c)&&!b.isNullOrUndefined(e)){const f={messageType:b.MessageType.createRecord,messageData:new Map().set(y.entityName,c).set(y.value,a.CIFramework.Utility.buildMap(JSON.parse(e)))};return new Promise((b,c)=>d(i.name,f,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(e)?b.postMessageNamespace.rejectWithErrorMessage("Provide a value to the parameter to create record."):void 0}function j(c,e){if(!(b.isNullOrUndefined(c)||""==c)&&!(b.isNullOrUndefined(e)||""==e)){const f={messageType:b.MessageType.deleteRecord,messageData:new Map().set(y.entityName,c).set(y.entityId,e)};return new Promise((b,c)=>d(j.name,f,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(e)||""==e?b.postMessageNamespace.rejectWithErrorMessage("The EntityId parameter is blank. Provide a value to the parameter."):void 0}function k(c,e,f){if(!(b.isNullOrUndefined(c)||""==c)&&!(b.isNullOrUndefined(e)||""==e)&&!b.isNullOrUndefined(f)){const g={messageType:f?b.MessageType.search:b.MessageType.searchAndOpenRecords,messageData:new Map().set(y.entityName,c).set(y.queryParameters,e).set(y.searchOnly,f)};return new Promise((b,c)=>d(k.name,g,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return c(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}return b.isNullOrUndefined(c)||""==c?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(e)||""==e?b.postMessageNamespace.rejectWithErrorMessage("The queryParmeters parameter is blank. Provide a value to the parameter."):b.isNullOrUndefined(f)?b.postMessageNamespace.rejectWithErrorMessage("The searchOnly parameter is blank. Provide a value to the parameter."):void 0}function l(){const a={messageType:b.MessageType.getMode,messageData:new Map};return d(l.name,a,!1)}function m(){const c={messageType:b.MessageType.getEnvironment,messageData:new Map};return new Promise((b,e)=>d(m.name,c,!1).then(function(c){return b(JSON.stringify(a.CIFramework.Utility.buildEntity(c)))},function(b){return e(JSON.stringify(a.CIFramework.Utility.buildEntity(b)))}))}function n(){Date.now();const a={messageType:b.MessageType.getWidth,messageData:new Map};return d(n.name,a,!1)}function o(a){Date.now();if(!b.isNullOrUndefined(a)&&0<=a){const c={messageType:b.MessageType.setWidth,messageData:new Map().set(y.value,a)};return d(o.name,c,!1)}return b.postMessageNamespace.rejectWithErrorMessage("The setWidth parameter value is invalid. Provide a positive number to the parameter.")}function p(a){Date.now();if(!b.isNullOrUndefined(a)&&(0==a||1==a)){const c={messageType:b.MessageType.setMode,messageData:new Map().set(y.value,a)};return d(p.name,c,!1)}return b.postMessageNamespace.rejectWithErrorMessage("The setMode paramter value must be 0 or 1.")}function q(){Date.now();const a={messageType:b.MessageType.getClickToAct,messageData:new Map};return d(q.name,a,!1)}function r(a,c){Date.now();if(!(b.isNullOrUndefined(a)||""==a)&&!b.isNullOrUndefined(c)){w.addHandler(a,c);const e={messageType:b.MessageType.addGenericHandler,messageData:new Map().set(y.eventType,a)};d("addGenericHandler",e,!1)}else{if(b.isNullOrUndefined(a)||""==a)return b.postMessageNamespace.rejectWithErrorMessage("The parameter EventName is blank. Provide a value to the parameter.");if(b.isNullOrUndefined(c))return b.postMessageNamespace.rejectWithErrorMessage("Passing data parameters to addHandler is mandatory.")}}function s(a,c){Date.now();if(!(b.isNullOrUndefined(a)||""==a)&&!b.isNullOrUndefined(c)){w.removeHandler(a,c);const e={messageType:b.MessageType.removeGenericHandler,messageData:new Map().set(y.eventType,a)};d("removeGenericHandler",e,!1)}else{if(b.isNullOrUndefined(a)||""==a)return b.postMessageNamespace.rejectWithErrorMessage("The EventName parameter is blank. Provide a value to the parameter.");if(b.isNullOrUndefined(c))return b.postMessageNamespace.rejectWithErrorMessage("Passing data parameters to removeHandler is mandatory.")}}function t(a,c){if(!(b.isNullOrUndefined(a)||""==a)){const e={messageType:b.MessageType.getEntityMetadata,messageData:new Map().set(y.entityName,a).set(y.Attributes,c)};return d(t.name,e,!1)}return b.isNullOrUndefined(a)||""==a?b.postMessageNamespace.rejectWithErrorMessage("The EntityName parameter is blank. Provide a value to the parameter"):void 0}function u(a,c){if(!(b.isNullOrUndefined(a)||""==a)&&!b.isNullOrUndefined(c)){const e={messageType:b.MessageType.renderSearchPage,messageData:new Map().set(y.entityName,a).set(y.SearchString,c)};return d(u.name,e,!1)}return b.isNullOrUndefined(a)||""==a?b.postMessageNamespace.rejectWithErrorMessage("The EntityName Parameter is blank. Provide a value to the parameter"):b.isNullOrUndefined(c)?b.postMessageNamespace.rejectWithErrorMessage("The SearchString Parameter cannot be NULL"):void 0}let v,w,x=[],y=a.CIFramework.Constants;b.setClickToAct=e,b.openForm=f,b.retrieveRecord=g,b.updateRecord=h,b.createRecord=i,b.deleteRecord=j,b.searchAndOpenRecords=k,b.getMode=l,b.getEnvironment=m,b.getWidth=n,b.setWidth=o,b.setMode=p,b.getClickToAct=q,b.addHandler=r,b.removeHandler=s,b.getEntityMetadata=t,b.renderSearchPage=u,c()})(b=a.CIFramework||(a.CIFramework={}))})(Microsoft||(Microsoft={}));